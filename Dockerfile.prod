# 使用官方的 OpenJDK 21 镜像作为基础镜像
FROM openjdk:21-jdk-slim

# 设置工作目录
WORKDIR /app

# 复制 Gradle wrapper 文件
COPY gradlew .
COPY gradle gradle
COPY build.gradle .
COPY settings.gradle .

# 复制源代码
COPY src src

# 构建应用（生产构建同样跳过单测以缩短镜像时间，可根据需要开启）
RUN chmod +x ./gradlew
RUN ./gradlew build -x test

# Cloud Run 会提供 PORT 环境变量；默认 8080
ENV PORT=8080
EXPOSE 8080

# 激活 Spring profile
ENV SPRING_PROFILES_ACTIVE=prod

# 运行应用
CMD ["java", "-jar", "build/libs/revenue-calculator-backend-edge-0.0.1-SNAPSHOT.jar"]


